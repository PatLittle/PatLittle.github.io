---
layout: default
---

<style>
/* =========================================================
   POST LAYOUT: 200px sidenav + 800px content
========================================================= */
.post-layout {
  margin: 40px auto;
  max-width: 1120px;
}

.post-shell {
  display: flex;
  gap: 24px;
  justify-content: center;
  align-items: flex-start;
}

.post-main {
  width: 800px;
  flex: 0 0 800px;
  min-width: 0;
}

/* =========================================================
   SIDE NAV (sticky, unlimited height)
========================================================= */
.post-sidenav {
  width: 200px;
  flex: 0 0 200px;
  position: sticky;
  top: 96px;
  padding: 14px 12px;
  border-radius: 16px;
  background: rgba(15, 23, 42, 0.55);
  border: 1px solid rgba(38, 52, 85, 0.6);

  max-height: none;
  overflow: visible;
}

.post-sidenav .sidenav-title {
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--muted);
  margin-bottom: 10px;
}

.post-sidenav nav a {
  display: block;
  padding: 6px 8px;
  border-radius: 10px;
  color: var(--muted);
  text-decoration: none;
  font-weight: 700;
  line-height: 1.25;
  border: 1px solid transparent;
}

.post-sidenav nav a:hover,
.post-sidenav nav a:focus {
  color: var(--text);
  border-color: rgba(236, 72, 153, 0.45);
  background: rgba(236, 72, 153, 0.10);
  outline: none;
}

.post-sidenav nav a.is-active {
  color: var(--text);
  border-color: rgba(236, 72, 153, 0.65);
  background: rgba(236, 72, 153, 0.18);
}

.post-sidenav nav a.level-h3 { padding-left: 16px; }
.post-sidenav nav a.level-h4 { padding-left: 26px; }

/* =========================================================
   RESPONSIVE FALLBACK
========================================================= */
@media (max-width: 1100px) {
  .post-shell {
    flex-direction: column;
  }

  .post-sidenav {
    width: 100%;
    position: relative;
    top: auto;
  }

  .post-main {
    width: 100%;
    flex: 1 1 auto;
  }
}

/* =========================================================
   ANCHORED HEADINGS (h2–h4)
========================================================= */
.post-content h2,
.post-content h3,
.post-content h4 {
  position: relative;
  scroll-margin-top: 96px;
}

.post-content h2 > a.heading-anchor,
.post-content h3 > a.heading-anchor,
.post-content h4 > a.heading-anchor {
  color: inherit;
  text-decoration: none;
  font-weight: inherit;
}

.post-content h2 > a.heading-anchor::before,
.post-content h3 > a.heading-anchor::before,
.post-content h4 > a.heading-anchor::before {
  content: "#";
  margin-right: 10px;
  color: hotpink;
  opacity: 0;
  transform: translateX(-6px);
  transition: opacity 0.15s ease, transform 0.15s ease;
}

.post-content h2:hover > a.heading-anchor::before,
.post-content h3:hover > a.heading-anchor::before,
.post-content h4:hover > a.heading-anchor::before {
  opacity: 1;
  transform: translateX(0);
}

/* =========================================================
   FIGURES + GALLERY IMAGES
========================================================= */
.post-content figure {
  margin: 18px auto;
  max-width: min(820px, 100%);
  border: 2px solid rgba(38, 52, 85, 0.9);
  border-radius: 18px;
  overflow: hidden;
  background: rgba(15, 23, 42, 0.45);
  box-shadow: var(--shadow);
}

.post-content figure img {
  display: block;
  width: 100%;
  height: auto;
  margin: 0 auto;
  min-width: 500px;
  max-width: 100%;
  cursor: zoom-in;
}

@media (max-width: 560px) {
  .post-content figure img {
    min-width: 0;
  }
}

.post-content figure figcaption {
  padding: 12px 14px;
  background: DarkSlateBlue;
  color: White;
  font-family: "Comic Sans MS", cursive;
  font-weight: 700;
  text-align: center;
  border-top: 2px solid rgba(38, 52, 85, 0.9);
}

/* =========================================================
   BLOCKQUOTES
========================================================= */
.post-content blockquote {
  margin: 18px 0;
  padding: 16px 18px;
  border-radius: 18px;
  background-image: linear-gradient(to bottom, DarkSlateBlue, Purple);
  color: #fff;
  font-weight: 800;
  border: 1px solid rgba(255, 255, 255, 0.18);
  box-shadow: 0 14px 28px rgba(15, 23, 42, 0.35);
}

.post-content blockquote p {
  color: inherit;
}

/* =========================================================
   LISTS
========================================================= */
.post-content ul,
.post-content ol {
  padding-left: 30px;
}

/* =========================================================
   GALLERY MODAL (NO SCROLL, FULL IMAGE FIT)
========================================================= */
.gallery-modal {
  position: fixed;
  inset: 0;
  display: none;
  z-index: 9999;
  background: rgba(0, 0, 0, 0.72);
  align-items: center;
  justify-content: center;
  padding: 24px;
}

.gallery-modal.is-open {
  display: flex;
}

.gallery-dialog {
  width: min(1100px, 96vw);
  height: min(92vh, 920px);
  display: grid;
  grid-template-rows: auto 1fr auto;
  border-radius: 18px;
  overflow: hidden;
  background: rgba(11, 18, 36, 0.85);
  border: 1px solid rgba(255, 255, 255, 0.18);
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow);
}

.gallery-bar,
.gallery-caption {
  padding: 12px 14px;
  background: rgba(15, 23, 42, 0.55);
  border-color: rgba(255, 255, 255, 0.12);
  position: relative;
  z-index: 2;
}

.gallery-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid rgba(255, 255, 255, 0.12);
}

.gallery-caption {
  border-top: 1px solid rgba(255, 255, 255, 0.12);
  font-weight: 700;
}

.gallery-actions {
  display: flex;
  gap: 10px;
}

.gallery-btn {
  appearance: none;
  border: 1px solid rgba(255, 255, 255, 0.18);
  background: rgba(148, 163, 184, 0.12);
  color: var(--text);
  border-radius: 999px;
  padding: 8px 12px;
  font-weight: 700;
  cursor: pointer;
  position: relative;
  z-index: 3;
}

.gallery-stage {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px;
  overflow: hidden;
}

.gallery-stage img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  border-radius: 14px;
  border: 1px solid rgba(255, 255, 255, 0.14);
}

/* Invisible click zones for prev / next */
.gallery-navzone {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 22%;
  cursor: pointer;
  z-index: 1;
}

.gallery-navzone.prev { left: 0; }
.gallery-navzone.next { right: 0; }
</style>

<div class="container post-layout">
  <div class="post-main">
    <h1>{{ page.title }}</h1>
    <div class="post-meta">{{ page.date | date: '%B %d, %Y' }} · {{ page.category | default: 'Writing' }}</div>
  </div>

  <div class="post-shell">
    <aside class="post-sidenav" aria-label="On this page">
      <div class="sidenav-title">On this page</div>
      <nav id="post-toc"></nav>
    </aside>

    <main class="post-main">
      <div class="post-content" id="post-content">
        {{ content }}
      </div>
    </main>
  </div>
</div>

<!-- Gallery modal -->
<div class="gallery-modal" id="galleryModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="gallery-dialog" role="document">
    <div class="gallery-bar">
      <div class="gallery-title" id="galleryTitle">Gallery</div>
      <div class="gallery-actions">
        <button class="gallery-btn" type="button" id="galleryPrev" aria-label="Previous image">Prev</button>
        <button class="gallery-btn" type="button" id="galleryNext" aria-label="Next image">Next</button>
        <button class="gallery-btn" type="button" id="galleryClose" aria-label="Close gallery">Close</button>
      </div>
    </div>

    <div class="gallery-stage" id="galleryStage">
      <!-- click zones for prev/next -->
      <div class="gallery-navzone prev" id="galleryZonePrev" aria-hidden="true"></div>
      <div class="gallery-navzone next" id="galleryZoneNext" aria-hidden="true"></div>

      <img id="galleryImage" alt="" />
    </div>

    <div class="gallery-caption" id="galleryCaption"></div>
  </div>
</div>

<script>
  (function () {
    const root = document.querySelector(".post-content");
    const toc = document.getElementById("post-toc");
    if (!root || !toc) return;

    // ---------- Heading anchors + TOC ----------
    const slugify = (text) =>
      text
        .toLowerCase()
        .trim()
        .replace(/[\s]+/g, "-")
        .replace(/[^\w\-]+/g, "")
        .replace(/\-+/g, "-");

    const used = new Map();
    const uniqueId = (base) => {
      const n = used.get(base) || 0;
      used.set(base, n + 1);
      return n ? `${base}-${n + 1}` : base;
    };

    const headings = Array.from(root.querySelectorAll("h2, h3, h4"));

    headings.forEach((h) => {
      // Ensure an id
      let id = h.id && h.id.trim() ? h.id.trim() : slugify(h.textContent);
      if (!id) return;
      id = uniqueId(id);
      h.id = id;

      // Wrap heading content in an anchor if not already wrapped
      if (!h.querySelector("a.heading-anchor")) {
        // If heading already has any link, leave it (avoid nested anchors)
        if (!h.querySelector("a")) {
          const a = document.createElement("a");
          a.className = "heading-anchor";
          a.href = `#${id}`;
          while (h.firstChild) a.appendChild(h.firstChild);
          h.appendChild(a);
        }
      }

      // Add to TOC
      const link = document.createElement("a");
      link.href = `#${id}`;
      link.textContent = h.textContent.trim();
      link.classList.add(`level-${h.tagName.toLowerCase()}`);
      toc.appendChild(link);
    });

    // Active link highlighting
    const tocLinks = Array.from(toc.querySelectorAll("a"));
    const byId = new Map(tocLinks.map((a) => [a.getAttribute("href").slice(1), a]));

    const setActive = (id) => {
      tocLinks.forEach((a) => a.classList.toggle("is-active", a.getAttribute("href") === `#${id}`));
    };

    const io = new IntersectionObserver(
      (entries) => {
        // Choose the closest visible heading to the top
        const visible = entries
          .filter((e) => e.isIntersecting)
          .sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top)[0];
        if (visible && visible.target && visible.target.id && byId.has(visible.target.id)) {
          setActive(visible.target.id);
        }
      },
      { rootMargin: "-25% 0px -65% 0px", threshold: [0, 1] }
    );

    headings.forEach((h) => io.observe(h));

    // ---------- Image gallery modal ----------
const modal = document.getElementById("galleryModal");
const dialog = modal ? modal.querySelector(".gallery-dialog") : null;
const imgEl = document.getElementById("galleryImage");
const capEl = document.getElementById("galleryCaption");
const titleEl = document.getElementById("galleryTitle");
const btnPrev = document.getElementById("galleryPrev");
const btnNext = document.getElementById("galleryNext");
const btnClose = document.getElementById("galleryClose");
const zonePrev = document.getElementById("galleryZonePrev");
const zoneNext = document.getElementById("galleryZoneNext");

const galleryItems = Array.from(root.querySelectorAll("figure img")).map((img) => {
  const fig = img.closest("figure");
  const cap = fig ? fig.querySelector("figcaption") : null;
  return {
    el: img,
    src: img.currentSrc || img.src,
    alt: img.alt || "",
    caption: cap ? cap.textContent.trim() : ""
  };
});

let current = 0;
let lastFocused = null;

function renderGallery() {
  const item = galleryItems[current];
  imgEl.src = item.src;
  imgEl.alt = item.alt || "";
  capEl.textContent = item.caption || "";
  titleEl.textContent = `Image ${current + 1} of ${galleryItems.length}`;
}

function openAt(i) {
  if (!galleryItems.length) return;
  current = ((i % galleryItems.length) + galleryItems.length) % galleryItems.length;
  lastFocused = document.activeElement;

  renderGallery();
  modal.classList.add("is-open");
  modal.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden";
  btnClose && btnClose.focus();
}

function closeGallery() {
  modal.classList.remove("is-open");
  modal.setAttribute("aria-hidden", "true");
  document.body.style.overflow = "";
  if (lastFocused && lastFocused.focus) lastFocused.focus();
}

function prevImage() {
  if (!galleryItems.length) return;
  openAt(current - 1);
}

function nextImage() {
  if (!galleryItems.length) return;
  openAt(current + 1);
}

// Click any gallery image to open
galleryItems.forEach((item, idx) => {
  item.el.dataset.galleryIndex = String(idx);
  item.el.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    openAt(idx);
  });
});

// Button wiring (stopPropagation prevents navzones/backdrop from hijacking clicks)
if (btnPrev) btnPrev.addEventListener("click", (e) => { e.stopPropagation(); prevImage(); });
if (btnNext) btnNext.addEventListener("click", (e) => { e.stopPropagation(); nextImage(); });
if (btnClose) btnClose.addEventListener("click", (e) => { e.stopPropagation(); closeGallery(); });

// Side click zones
if (zonePrev) zonePrev.addEventListener("click", (e) => { e.stopPropagation(); prevImage(); });
if (zoneNext) zoneNext.addEventListener("click", (e) => { e.stopPropagation(); nextImage(); });

// Backdrop click closes (but clicks inside dialog do not)
if (modal) {
  modal.addEventListener("click", (e) => {
    if (e.target === modal) closeGallery();
  });
}
if (dialog) {
  dialog.addEventListener("click", (e) => e.stopPropagation());
}

// Keyboard
document.addEventListener("keydown", (e) => {
  if (!modal || !modal.classList.contains("is-open")) return;
  if (e.key === "Escape") closeGallery();
  if (e.key === "ArrowLeft") prevImage();
  if (e.key === "ArrowRight") nextImage();
});

  })();
</script>
